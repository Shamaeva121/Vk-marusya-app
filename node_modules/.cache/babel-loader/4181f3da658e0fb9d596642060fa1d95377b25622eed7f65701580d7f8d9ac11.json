{"ast":null,"code":"import _objectSpread from\"d:/Users/User55/Documents/GitHub/Vk-marusya-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/auth/AuthModal/AuthModal.tsx\nimport React,{useState,useCallback}from'react';import{LoginForm}from'../LoginForm/LoginForm';import RegisterForm from'../RegisterForm/RegisterForm';import RegistrationSuccessModal from'../RegistrationSuccessModal/RegistrationSuccessModal';import{registerUser,loginUser}from'../../api/apiClient';import'./AuthModal.scss';import{useMutation,useQueryClient}from'@tanstack/react-query';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const AuthModal=_ref=>{let{isOpen,onClose,onAuthSuccess}=_ref;const[authType,setAuthType]=useState('login');const[showRegComplete,setShowRegComplete]=useState(false);const[apiError,setApiError]=useState(null);const queryClient=useQueryClient();const loginMutationOptions={mutationFn:loginData=>loginUser(loginData),onSuccess:data=>{if(data.result&&data.user){onAuthSuccess(data.user);onClose();queryClient.invalidateQueries({queryKey:['user'],exact:true});}else{handleApiError(data.message||'Неверный email или пароль.');}},onError:error=>{handleApiError('Ошибка при логине. Попробуйте позже.');console.error('Login error:',error.message);}};const loginMutation=useMutation(loginMutationOptions);const registerMutationOptions={mutationFn:registerData=>registerUser(registerData),onSuccess:data=>{if(data.result&&data.user){setShowRegComplete(true);queryClient.invalidateQueries({queryKey:['user'],exact:true});}else{handleApiError(data.message||'Ошибка при регистрации.');}},onError:error=>{handleApiError('Ошибка при регистрации.');console.error('Register error:',error.message);}};const registerMutation=useMutation(registerMutationOptions);const handleToggleAuthType=useCallback(type=>{setAuthType(type);setApiError(null);},[]);const handleApiError=useCallback(message=>{setApiError(message);},[]);const handleLogin=data=>{loginMutation.mutate(data);};const handleRegister=formData=>{registerMutation.mutate(formData);};const handleRegCompleteCloseAndLogin=useCallback(async()=>{setShowRegComplete(false);setAuthType('login');},[]);const loginFormProps={onSubmit:handleLogin,onToggleAuthType:handleToggleAuthType,isLoading:loginMutation.isPending};const registerFormProps={onSubmit:handleRegister,onToggleAuthType:handleToggleAuthType,isLoading:registerMutation.isPending};const handleOverlayClick=useCallback(e=>{if(e.target===e.currentTarget){onClose();}},[onClose]);if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"auth-modal-overlay\",onClick:handleOverlayClick,children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-modal__content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{className:\"auth-modal__close-button\",onClick:onClose,children:/*#__PURE__*/_jsx(\"img\",{src:\"/icons/icon-back-modal.svg\",alt:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"auth-modal__header\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/icons/logo-icon-modal.svg\",alt:\"\\u041B\\u043E\\u0433\\u043E\\u0442\\u0438\\u043F\",className:\"auth-modal__logo\"})}),showRegComplete?/*#__PURE__*/_jsx(RegistrationSuccessModal,{isOpen:showRegComplete,onClose:handleRegCompleteCloseAndLogin,onLoginClick:handleRegCompleteCloseAndLogin}):/*#__PURE__*/_jsx(_Fragment,{children:authType==='login'?/*#__PURE__*/_jsx(LoginForm,_objectSpread({},loginFormProps)):/*#__PURE__*/_jsx(RegisterForm,_objectSpread({},registerFormProps))})]})});};export default AuthModal;","map":{"version":3,"names":["React","useState","useCallback","LoginForm","RegisterForm","RegistrationSuccessModal","registerUser","loginUser","useMutation","useQueryClient","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","AuthModal","_ref","isOpen","onClose","onAuthSuccess","authType","setAuthType","showRegComplete","setShowRegComplete","apiError","setApiError","queryClient","loginMutationOptions","mutationFn","loginData","onSuccess","data","result","user","invalidateQueries","queryKey","exact","handleApiError","message","onError","error","console","loginMutation","registerMutationOptions","registerData","registerMutation","handleToggleAuthType","type","handleLogin","mutate","handleRegister","formData","handleRegCompleteCloseAndLogin","loginFormProps","onSubmit","onToggleAuthType","isLoading","isPending","registerFormProps","handleOverlayClick","e","target","currentTarget","className","onClick","children","stopPropagation","src","alt","onLoginClick","_objectSpread"],"sources":["d:/Users/User55/Documents/GitHub/Vk-marusya-app/src/auth/AuthModal/AuthModal.tsx"],"sourcesContent":["// src/auth/AuthModal/AuthModal.tsx\nimport React, { useState, useCallback } from 'react';\nimport { LoginForm } from '../LoginForm/LoginForm';\nimport RegisterForm from '../RegisterForm/RegisterForm';\nimport RegistrationSuccessModal from '../RegistrationSuccessModal/RegistrationSuccessModal';\nimport { registerUser, loginUser } from '../../api/apiClient';\nimport './AuthModal.scss';\nimport { AuthModalProps, RegisterFormProps, RegisterFormData, LoginFormProps, LoginFormData, User, AuthType } from \"../../types/types\";\nimport { useMutation, UseMutationOptions, useQueryClient } from '@tanstack/react-query';\n\ninterface AuthApiResponse {\n  result: boolean;\n  user?: User;\n  message?: string;\n}\n\nconst AuthModal: React.FC<AuthModalProps> = ({ isOpen, onClose, onAuthSuccess }) => {\n  const [authType, setAuthType] = useState<AuthType>('login');\n  const [showRegComplete, setShowRegComplete] = useState(false);\n  const [apiError, setApiError] = useState<string | null>(null);\n\n  const queryClient = useQueryClient();\n\n  const loginMutationOptions: UseMutationOptions<AuthApiResponse, Error, LoginFormData, unknown> = {\n    mutationFn: (loginData: LoginFormData) => loginUser(loginData),\n    onSuccess: (data) => {\n      if (data.result && data.user) {\n        onAuthSuccess(data.user);\n        onClose();\n        queryClient.invalidateQueries({ queryKey: ['user'], exact: true }); \n      } else {\n        handleApiError(data.message || 'Неверный email или пароль.');\n      }\n    },\n    onError: (error: Error) => {\n      handleApiError('Ошибка при логине. Попробуйте позже.');\n      console.error('Login error:', error.message);\n    },\n  };\n  const loginMutation = useMutation(loginMutationOptions);\n\n  const registerMutationOptions: UseMutationOptions<AuthApiResponse, Error, RegisterFormData, unknown> = {\n    mutationFn: (registerData: RegisterFormData) => registerUser(registerData),\n    onSuccess: (data) => {\n      if (data.result && data.user) {\n        setShowRegComplete(true);\n        queryClient.invalidateQueries({ queryKey: ['user'], exact: true }); \n      } else {\n        handleApiError(data.message || 'Ошибка при регистрации.');\n      }\n    },\n    onError: (error: Error) => {\n      handleApiError('Ошибка при регистрации.');\n      console.error('Register error:', error.message);\n    },\n  };\n  const registerMutation = useMutation(registerMutationOptions);\n\n  const handleToggleAuthType = useCallback((type: AuthType) => {\n    setAuthType(type);\n    setApiError(null);\n  }, []);\n\n  const handleApiError = useCallback((message: string) => {\n    setApiError(message);\n  }, []);\n\n  const handleLogin = (data: LoginFormData) => {\n    loginMutation.mutate(data);\n  };\n\n  const handleRegister = (formData: RegisterFormData) => {\n    registerMutation.mutate(formData);\n  };\n\n  const handleRegCompleteCloseAndLogin = useCallback(async () => {\n    setShowRegComplete(false);\n    setAuthType('login');\n  }, []);\n\n  const loginFormProps: LoginFormProps = {\n    onSubmit: handleLogin,\n    onToggleAuthType: handleToggleAuthType,\n    isLoading: loginMutation.isPending,\n  };\n\n  const registerFormProps: RegisterFormProps = {\n    onSubmit: handleRegister,\n    onToggleAuthType: handleToggleAuthType,\n    isLoading: registerMutation.isPending,\n  };\n\n  const handleOverlayClick = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    if (e.target === e.currentTarget) {\n      onClose();\n    }\n  }, [onClose]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"auth-modal-overlay\" onClick={handleOverlayClick}>\n      <div className=\"auth-modal__content\" onClick={(e) => e.stopPropagation()}>\n        <button className=\"auth-modal__close-button\" onClick={onClose}>\n          <img src=\"/icons/icon-back-modal.svg\"  alt=\"Закрыть\" /> \n        </button>\n        <div className=\"auth-modal__header\">\n          <img src=\"/icons/logo-icon-modal.svg\" alt=\"Логотип\" className=\"auth-modal__logo\" /> \n        </div>\n        {showRegComplete ? (\n          <RegistrationSuccessModal\n            isOpen={showRegComplete}\n            onClose={handleRegCompleteCloseAndLogin}\n            onLoginClick={handleRegCompleteCloseAndLogin}\n          />\n        ) : (\n          <>\n            {authType === 'login' ? (\n              <LoginForm {...loginFormProps} />\n            ) : (\n              <RegisterForm {...registerFormProps} />\n            )}\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AuthModal;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}